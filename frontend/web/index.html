<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UniVibe</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script>
      // POLYFILL CRÍTICO - Debe ejecutarse ANTES de cualquier otro código
      (function() {
        'use strict';
        
        // Asegurar globalThis
        var g = typeof globalThis !== 'undefined' ? globalThis : 
                (typeof window !== 'undefined' ? window : 
                 (typeof self !== 'undefined' ? self : 
                  (typeof global !== 'undefined' ? global : this)));
        if (typeof globalThis === 'undefined') {
          g.globalThis = g;
        }
        
        // Polyfill para Request - FORZAR siempre que fetch exista
        if (typeof fetch !== 'undefined') {
          var RequestImpl = function Request(input, init) {
            if (!(this instanceof RequestImpl)) {
              throw new TypeError('Failed to construct Request: Please use the new operator');
            }
            this.url = typeof input === 'string' ? input : 
                      (input instanceof URL ? input.href : 
                       (input && typeof input === 'object' && 'url' in input ? input.url : 
                        String(input)));
            init = init || {};
            this.method = (init.method || 'GET').toUpperCase();
            this.headers = new Headers(init.headers || {});
            this.body = init.body !== undefined ? init.body : null;
            this.mode = init.mode || 'cors';
            this.credentials = init.credentials || 'same-origin';
            this.cache = init.cache || 'default';
            this.redirect = init.redirect || 'follow';
            this.referrer = init.referrer || 'about:client';
            this.integrity = init.integrity || '';
          };
          RequestImpl.prototype.clone = function() {
            return Object.assign(Object.create(Object.getPrototypeOf(this)), this);
          };
          
          // FORZAR asignación a TODOS los contextos posibles
          g.Request = RequestImpl;
          if (typeof window !== 'undefined') {
            window.Request = RequestImpl;
            try {
              Object.defineProperty(window, 'Request', {
                value: RequestImpl,
                writable: true,
                configurable: true,
                enumerable: true
              });
            } catch (e) {
              window.Request = RequestImpl;
            }
          }
          if (typeof self !== 'undefined') self.Request = RequestImpl;
          if (typeof global !== 'undefined') global.Request = RequestImpl;
          if (typeof module !== 'undefined' && module.exports) {
            module.exports.Request = RequestImpl;
          }
        }
        
        // Polyfill para process.nextTick
        if (typeof process === 'undefined' || !process.nextTick) {
          var processPolyfill = typeof process !== 'undefined' ? process : { env: {}, versions: {} };
          if (!processPolyfill.nextTick) {
            processPolyfill.nextTick = function(callback) {
              if (typeof queueMicrotask !== 'undefined') {
                queueMicrotask(callback);
              } else if (typeof Promise !== 'undefined') {
                Promise.resolve().then(callback);
              } else {
                setTimeout(callback, 0);
              }
            };
          }
          g.process = processPolyfill;
          if (typeof window !== 'undefined') window.process = processPolyfill;
          if (typeof global !== 'undefined') global.process = processPolyfill;
        }
      })();
      
      // Callback para Spotify Web Playback SDK
      window.onSpotifyWebPlaybackSDKReady = function() {
        console.log('Spotify Web Playback SDK está listo');
      };
    </script>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
  </head>
  <body class="antialiased bg-surface-light text-slate-900 dark:bg-slate-100 dark:bg-surface-dark">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
